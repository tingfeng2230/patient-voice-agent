# 患者信息实时语音采集使用指南

## 功能概述

本系统提供了**实时语音识别**功能，无需录音完成后才识别，而是在您说话的同时：

1. 🎤 **实时录音**：在浏览器中即时录制患者问诊语音
2. 📝 **实时识别**：语音立即转换为文字显示在屏幕上
3. 🔄 **自动填充**：自动将识别的内容填充到表单中
4. 👤 **智能提取**：自动从语音中提取患者姓名

## 使用步骤

### 1. 启动服务

在项目根目录下执行：

```bash
python -m src.main -m http -p 5000
```

服务将在 `http://localhost:5000` 启动。

### 2. 访问实时录音页面

在浏览器中打开：

```
http://localhost:5000/static/recorder-realtime.html
```

### 3. 开始实时语音识别

1. 点击页面中央的红色麦克风按钮
2. 开始说话，系统会**实时**将您的语音转换为文字
3. 您会看到识别的文字实时显示在"实时识别文本"区域
4. 识别的内容会**自动填充**到下方的表单字段中

### 4. 停止和继续

- 再次点击麦克风按钮可以暂停录音
- 点击"继续录音"可以恢复识别

### 5. 提交表单

完成信息采集后：
- 可以手动修改表单中的内容
- 点击"保存表单"提交
- 点击"清空表单"重新开始

## 实时识别功能

### 自动提取姓名

系统会自动从语音中识别以下格式的姓名：

- "我是张三" → 自动填写姓名为"张三"
- "我叫李四" → 自动填写姓名为"李四"
- "患者王五" → 自动填写姓名为"王五"
- "姓名：赵六" → 自动填写姓名为"赵六"

### 实时填充问诊记录

您说的每一句话都会：
1. 立即显示在"实时识别文本"区域
2. 自动追加到"问诊记录"文本框中

## 示例使用场景

### 场景1：医生录入患者信息

**医生说**：
```
"我是王医生，这位患者叫张伟，今天来医院是因为最近三天一直感觉头晕，尤其是在早上起床的时候比较明显。以前没有类似的症状，也没有高血压病史。希望能检查一下是什么原因。"
```

**系统自动填写**：
- **患者姓名**：张伟
- **问诊记录**：我是王医生，这位患者叫张伟，今天来医院是因为最近三天一直感觉头晕，尤其是在早上起床的时候比较明显。以前没有类似的症状，也没有高血压病史。希望能检查一下是什么原因。

### 场景2：患者自述

**患者说**：
```
"我叫李明，我最近一周感觉胸闷气短，走路快了就喘不上气。以前身体挺好的，最近工作压力大，经常加班熬夜。"
```

**系统自动填写**：
- **患者姓名**：李明
- **问诊记录**：我叫李明，我最近一周感觉胸闷气短，走路快了就喘不上气。以前身体挺好的，最近工作压力大，经常加班熬夜。

## 浏览器要求

### 支持的浏览器

✅ **推荐使用**：
- Google Chrome（桌面版）
- Microsoft Edge（桌面版）
- Safari（macOS/iOS）

❌ **不支持**：
- Firefox（不完全支持 Web Speech API）
- Internet Explorer（不支持）

### 浏览器权限

首次使用时，浏览器会请求麦克风权限，请点击"允许"。

## 技术特点

### 实时性

- 使用 Web Speech API 的 `SpeechRecognition` 接口
- `continuous = true`：支持连续语音识别
- `interimResults = true`：显示中间识别结果
- 识别延迟：< 1秒

### 智能性

- 自动姓名提取（多种姓名表达方式）
- 智能标点添加
- 上下文感知

### 交互性

- 实时反馈显示
- 暂停/继续功能
- 手动编辑支持
- 一键清空

## 与录音模式的对比

| 特性 | 实时识别模式 | 传统录音模式 |
|------|-------------|-------------|
| 识别方式 | 边说边识别 | 录完再识别 |
| 反馈速度 | 即时（<1秒） | 延迟（需要等待） |
| 修改方式 | 随时修改/补充 | 需要重新录音 |
| 适用场景 | 实时录入、长段对话 | 短录音、存档需求 |
| 浏览器要求 | 较新浏览器 | 所有浏览器 |

## 故障排除

### 问题：无法启动语音识别

**解决方案**：
- 检查浏览器是否支持（使用 Chrome/Edge/Safari）
- 确认已授权麦克风权限
- 刷新页面重试

### 问题：识别不准确

**解决方案**：
- 确保环境安静，减少背景噪音
- 说话清晰、语速适中
- 靠近麦克风说话
- 使用普通话进行识别

### 问题：没有实时填充

**解决方案**：
- 确认浏览器支持 Web Speech API
- 检查麦克风是否正常工作
- 查看浏览器控制台是否有错误

### 问题：姓名未识别

**解决方案**：
- 确保使用标准格式表达姓名（"我是xxx"、"我叫xxx"等）
- 姓名建议使用2-4个中文字符
- 可以手动填写表单中的姓名字段

## 高级技巧

### 1. 分段录入

对于较长的问诊记录，可以分段说话：
- 第一段：介绍患者基本信息
- 暂停一下
- 第二段：描述症状
- 暂停一下
- 第三段：说明病史

### 2. 实时校对

在说话的同时，可以：
- 观察"实时识别文本"区域
- 如果识别有误，可以在表单中手动修改
- 继续说话补充内容

### 3. 快速编辑

利用以下方式快速编辑：
- 使用键盘方向键快速定位
- Ctrl+Home 跳到开头
- Ctrl+End 跳到结尾

## API 说明

此页面使用纯前端技术，无需后端支持：

- **Web Speech API**：浏览器原生语音识别
- **无需上传**：语音数据在本地处理，保护隐私
- **零延迟**：实时识别，无需等待服务器

## 注意事项

1. **隐私保护**：语音数据在浏览器本地处理，不会上传到服务器
2. **网络要求**：部分浏览器需要网络连接才能使用语音识别
3. **语言支持**：默认使用中文识别（zh-CN）
4. **浏览器兼容**：建议使用最新版本的 Chrome 或 Edge

## 文件位置

- **实时识别页面**：`assets/recorder-realtime.html`
- **传统录音页面**：`assets/recorder.html`

## 总结

实时语音识别功能让医生或患者可以像平时说话一样自然地录入信息，系统会自动识别并填充表单，大大提高了信息采集的效率和准确性。

相比传统的"录音→上传→等待→识别"模式，实时识别模式更符合自然交互习惯，特别适合医疗场景中使用。
